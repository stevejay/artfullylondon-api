service: artfullylondon-search-service

frameworkVersion: ">=1.2.0 <2.0.0"

package:
    individually: true

provider:
    name: aws
    runtime: nodejs8.10
    stage: production
    region: eu-west-1
    environment: ${file(env.yml):${self:custom.stage}}
    iamRoleStatements:
        -
            Effect: "Allow"
            Action: "cloudwatch:PutMetricData"
            Resource: "*"

plugins:
    - serverless-webpack
    - serverless-offline

custom:
    project: artfullylondon
    stage: ${opt:stage, self:provider.stage}
    region: ${opt:region, self:provider.region}
    webpackIncludeModules: true

functions:
    autocompleteSearch:
        handler: src/handlers/autocomplete-search.handler
        environment:
            SERVERLESS_REGION: ${self:custom.region}
        events:
            - http:
                path: "admin/search/auto"
                method: get
                cors: true
            - http:
                path: "public/search/auto"
                method: get
                cors: true
    basicSearch:
        handler: src/handlers/basic-search.handler
        environment:
            SERVERLESS_REGION: ${self:custom.region}
        events:
            - http:
                path: "admin/search/basic"
                method: get
                cors: true
            - http:
                path: "public/search/basic"
                method: get
                cors: true
    eventAdvancedSearch:
        handler: src/handlers/event-advanced-search.handler
        environment:
            SERVERLESS_REGION: ${self:custom.region}
        events:
            - http:
                path: "public/search/event"
                method: get
                cors: true
    presetSearch:
        handler: src/handlers/preset-search.handler
        environment:
            SERVERLESS_REGION: ${self:custom.region}
        events:
            - http:
                path: "public/search/preset/{name}"
                method: get
                cors: true
            - http:
                path: "admin/search/preset/{name}"
                method: get
                cors: true
